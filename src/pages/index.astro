---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Fetch all blog posts, sorted by date
const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

---
<BaseLayout title="Blog" description="All the posts from my blog.">
	<style>
		/* Tag styles */
		.tags {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			gap: 0.5em;
			margin: 0.5em 0 1em 0; /* 0.5em top, 1em bottom */
		}
		.tag {
			font-size: 0.8em;
			color: var(--accent-dark);
			background-color: rgba(var(--accent-rgb), 0.1);
			padding: 0.3em 0.8em;
			border-radius: 999px;
			border: 1px solid rgba(var(--accent-rgb), 0.5);
			text-decoration: none;
			white-space: nowrap;
		}
		/* List item structure styles */
		ul {
			list-style-type: none;
			padding: 0;
		}
		li a h3 {
			margin-bottom: 0.25em;
		}
		/* Remove rule for li p small */
		li > p:first-of-type { /* Target date paragraph */
			margin-bottom: 0.25em; /* Small gap below date */
		}
		li > p:last-of-type { /* Target excerpt paragraph */
			margin-bottom: 0; /* Remove margin, rely on li spacing */
		}
		/* Remove general li p rule */
	</style>
	<h1>My Blog</h1>
	<ul>
		{posts.map((post) => (
			<li style="margin-bottom: 2em; text-align: center;">
				<p><small>Published on: {post.data.pubDate.toLocaleDateString()}</small></p>
				<a href={`/${post.slug}/`}><h3>{post.data.title}</h3></a>
				{post.data.tags && post.data.tags.length > 0 && (
					<div class="tags">
						{post.data.tags.map((tag) => (
							<span class="tag">{tag}</span>
						))}
					</div>
				)}
				<p>{post.data.excerpt}</p>
			</li>
		))}
	</ul>
</BaseLayout>